# ğŸš€ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ WebSocketãƒãƒ£ãƒƒãƒˆã‚µãƒ¼ãƒãƒ¼

Pythonã®æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª + `websockets`ã‚’ä½¿ã£ãŸé«˜åº¦ãªWebSocketãƒãƒ£ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ã€‚

## âœ¨ æ©Ÿèƒ½

### ã‚³ã‚¢æ©Ÿèƒ½
- **WebSocketãƒ™ãƒ¼ã‚¹ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡**: åŒæ–¹å‘é€šä¿¡ã§ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
- **è¤‡æ•°ãƒ«ãƒ¼ãƒ å¯¾å¿œ**: ãƒãƒ£ãƒ³ãƒãƒ«åˆ†ã‘ãŒå¯èƒ½
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹ç®¡ç†**: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã®è¿½è·¡
- **å…¥åŠ›ä¸­ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿**: ã€Œâ—‹â—‹ãŒå…¥åŠ›ä¸­...ã€è¡¨ç¤º
- **éåŒæœŸå‡¦ç†**: asyncioã§é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **æ¥ç¶šç®¡ç†**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šã®è¿½è·¡ã¨ç®¡ç†
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å …ç‰¢ãªã‚¨ãƒ©ãƒ¼å‡¦ç†

### é«˜åº¦ãªæ©Ÿèƒ½
- **ãƒ«ãƒ¼ãƒ ã®è‡ªå‹•ä½œæˆ/å‰Šé™¤**: ç©ºãƒ«ãƒ¼ãƒ ã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ**: ãƒ«ãƒ¼ãƒ å˜ä½ã®åŠ¹ç‡çš„ãªé…ä¿¡
- **ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ**: Ping/Pongã§æ¥ç¶šç›£è¦–
- **çµ±è¨ˆæƒ…å ±**: æ¥ç¶šæ•°ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ãªã©ã®è¿½è·¡

## ğŸ“¦ å¿…è¦ãªã‚‚ã®

```bash
# Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³
Python 3.7ä»¥ä¸Š

# ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
pip install websockets
```

## ğŸš€ èµ·å‹•æ–¹æ³•

### 1. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
python server.py
```

èµ·å‹•ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¾ã™:

```
============================================================
ğŸš€ Starting WebSocket Chat Server
ğŸ“¡ Listening on ws://localhost:8765
============================================================
```

### 2. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶š

ãƒ–ãƒ©ã‚¦ã‚¶ã§ `client.html` ã‚’é–‹ãã‹ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•:

```bash
# Pythonã®ç°¡æ˜“ã‚µãƒ¼ãƒãƒ¼
python -m http.server 8000

# ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
# http://localhost:8000/client.html
```

### 3. è¤‡æ•°ã‚¿ãƒ–ã§é–‹ã„ã¦ãƒ†ã‚¹ãƒˆ

è¤‡æ•°ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ã§ `client.html` ã‚’é–‹ãã¨ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒåŒæœŸã•ã‚Œã¾ã™ã€‚

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
realtime_chat/
â”œâ”€â”€ server.py              # WebSocketã‚µãƒ¼ãƒãƒ¼æœ¬ä½“
â”œâ”€â”€ connection_manager.py  # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šç®¡ç†
â”œâ”€â”€ room_manager.py        # ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ç®¡ç†
â”œâ”€â”€ client.html            # ãƒ†ã‚¹ãƒˆç”¨Webã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â””â”€â”€ README.md              # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ”§ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ChatServer (server.py)          â”‚
â”‚  - WebSocketæ¥ç¶šç®¡ç†                     â”‚
â”‚  - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°                 â”‚
â”‚  - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚               â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Connection    â”‚  â”‚  Room             â”‚
â”‚ Manager       â”‚  â”‚  Manager          â”‚
â”‚               â”‚  â”‚                   â”‚
â”‚ - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â”‚  â”‚ - ãƒ«ãƒ¼ãƒ ä½œæˆ/å‰Šé™¤  â”‚
â”‚   æƒ…å ±ç®¡ç†     â”‚  â”‚ - ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†     â”‚
â”‚ - WebSocket   â”‚  â”‚ - ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ â”‚
â”‚   ä¿æŒ         â”‚  â”‚   åˆ¶å¾¡            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ãƒ­ãƒ¼

```
Client A                Server                Client B
   â”‚                      â”‚                      â”‚
   â”‚â”€â”€â”€â”€â”€ auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚<â”€â”€â”€â”€ welcome â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
   â”‚                      â”‚                      â”‚
   â”‚â”€â”€â”€ join_room â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                      â”‚â”€â”€â”€ user_joined â”€â”€â”€â”€â”€>â”‚
   â”‚                      â”‚                      â”‚
   â”‚â”€â”€â”€â”€ chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                      â”‚â”€â”€â”€â”€ message â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚<â”€â”€â”€â”€ message â”€â”€â”€â”€â”€â”€â”€â”€â”‚<â”€â”€â”€â”€ chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                      â”‚                      â”‚
   â”‚â”€â”€â”€ typing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
   â”‚                      â”‚â”€â”€â”€â”€ typing â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
```

## ğŸ“¡ ãƒ—ãƒ­ãƒˆã‚³ãƒ«ä»•æ§˜

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼

#### 1. èªè¨¼ (å¿…é ˆãƒ»æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)

```json
{
  "type": "auth",
  "username": "YourUsername"
}
```

#### 2. ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

```json
{
  "type": "chat",
  "room": "general",
  "content": "Hello, World!"
}
```

#### 3. å…¥åŠ›ä¸­é€šçŸ¥

```json
{
  "type": "typing",
  "room": "general",
  "is_typing": true
}
```

#### 4. ãƒ«ãƒ¼ãƒ å‚åŠ 

```json
{
  "type": "join_room",
  "room": "random"
}
```

#### 5. ãƒ«ãƒ¼ãƒ é€€å‡º

```json
{
  "type": "leave_room",
  "room": "random"
}
```

#### 6. ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ

```json
{
  "type": "ping"
}
```

### ã‚µãƒ¼ãƒãƒ¼ â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

#### 1. ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```json
{
  "type": "welcome",
  "client_id": "uuid-here",
  "username": "YourUsername",
  "message": "Welcome to the chat server!",
  "timestamp": "2025-01-01T12:00:00"
}
```

#### 2. ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

```json
{
  "type": "message",
  "room": "general",
  "sender": "Alice",
  "sender_id": "uuid-here",
  "content": "Hello!",
  "timestamp": "2025-01-01T12:00:00"
}
```

#### 3. å…¥åŠ›ä¸­é€šçŸ¥

```json
{
  "type": "typing",
  "room": "general",
  "user": "Bob",
  "user_id": "uuid-here",
  "is_typing": true
}
```

#### 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼å‚åŠ /é€€å‡º

```json
{
  "type": "user_joined",
  "room": "general",
  "user": "Charlie",
  "user_id": "uuid-here",
  "timestamp": "2025-01-01T12:00:00"
}
```

#### 5. ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹å¤‰æ›´

```json
{
  "type": "presence",
  "room": "general",
  "user": "Diana",
  "user_id": "uuid-here",
  "status": "online",
  "timestamp": "2025-01-01T12:00:00"
}
```

#### 6. ã‚¨ãƒ©ãƒ¼

```json
{
  "type": "error",
  "message": "Error description",
  "timestamp": "2025-01-01T12:00:00"
}
```

## ğŸ¯ ä½¿ç”¨ä¾‹

### Pythonã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä¾‹

```python
import asyncio
import websockets
import json

async def chat_client():
    uri = "ws://localhost:8765"
    
    async with websockets.connect(uri) as websocket:
        # èªè¨¼
        await websocket.send(json.dumps({
            "type": "auth",
            "username": "PythonBot"
        }))
        
        # ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
        response = await websocket.recv()
        print(f"Received: {response}")
        
        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
        await websocket.send(json.dumps({
            "type": "chat",
            "room": "general",
            "content": "Hello from Python!"
        }))
        
        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ãƒ«ãƒ¼ãƒ—
        while True:
            message = await websocket.recv()
            data = json.loads(message)
            print(f"Received: {data}")

asyncio.run(chat_client())
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### åŸºæœ¬å‹•ä½œç¢ºèª

1. **è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶š**
   - 3ã¤ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ã§åŒæ™‚æ¥ç¶š
   - å…¨å“¡ãŒãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã§ãã‚‹ã‹ç¢ºèª

2. **å…¥åŠ›ä¸­è¡¨ç¤º**
   - ã‚¿ãƒ–Aã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›
   - ã‚¿ãƒ–Bã§ã€Œâ—‹â—‹ãŒå…¥åŠ›ä¸­...ã€ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª

3. **ãƒ«ãƒ¼ãƒ æ©Ÿèƒ½**
   - ç•°ãªã‚‹ãƒ«ãƒ¼ãƒ ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
   - ãƒ«ãƒ¼ãƒ ã”ã¨ã«åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

4. **æ¥ç¶š/åˆ‡æ–­**
   - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆ‡æ–­æ™‚ã«é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª
   - å†æ¥ç¶šãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ç¢ºèª

### è² è·ãƒ†ã‚¹ãƒˆ

```bash
# 100ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåŒæ™‚æ¥ç¶šï¼ˆåˆ¥é€”ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆï¼‰
python load_test.py --clients 100 --messages 1000
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

ç¾åœ¨ã®å®Ÿè£…ã¯ **ãƒ‡ãƒ¢/å­¦ç¿’ç”¨** ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„:

- [ ] TLS/SSLæš—å·åŒ– (wss://)
- [ ] èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ (JWTç­‰)
- [ ] Rate limiting (DDoSå¯¾ç­–)
- [ ] å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ (XSSå¯¾ç­–)
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¤œè¨¼
- [ ] ãƒ­ã‚°ç›£è¦–

## ğŸš€ æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢

- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´ä¿å­˜)
- [ ] Redis Pub/Sub (è¤‡æ•°ã‚µãƒ¼ãƒãƒ¼é–“ã®åŒæœŸ)
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«é€ä¿¡æ©Ÿèƒ½
- [ ] ãƒ“ãƒ‡ã‚ª/éŸ³å£°é€šè©± (WebRTC)
- [ ] ãƒœãƒƒãƒˆ API
- [ ] ç®¡ç†è€…ã‚³ãƒãƒ³ãƒ‰
- [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¤œç´¢
- [ ] ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½

## ğŸ“š æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Python 3.7+**: asyncio, typing
- **websockets**: WebSocketé€šä¿¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: json, uuid, datetime, logging, collections

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒãƒ¼ãƒˆãŒä½¿ç”¨ä¸­

```bash
# ãƒãƒ¼ãƒˆ8765ã‚’ä½¿ã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
lsof -i :8765

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†
kill -9 <PID>
```

### æ¥ç¶šã‚¨ãƒ©ãƒ¼

- ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šã‚’ç¢ºèª
- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šã‹ãªã„

- ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§WebSocketæ¥ç¶šçŠ¶æ…‹ã‚’ç¢ºèª
- ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã§é€å—ä¿¡ã‚’ç¢ºèª

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è‡ªç”±ã«ä½¿ã£ã¦OKï¼

## ğŸ™ å‚è€ƒè³‡æ–™

- [WebSocket RFC 6455](https://tools.ietf.org/html/rfc6455)
- [Python websockets documentation](https://websockets.readthedocs.io/)
- [asyncio documentation](https://docs.python.org/3/library/asyncio.html)

---

**ä½œæˆè€…**: Claude  
**æ›´æ–°æ—¥**: 2025å¹´  
**é›£æ˜“åº¦**: â­â­â­â­â˜† (ä¸Šç´šè€…å‘ã‘)
